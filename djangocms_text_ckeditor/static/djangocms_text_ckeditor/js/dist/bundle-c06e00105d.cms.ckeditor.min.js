(function ($) {
    $(function () {

!function(t){window.CKEDITOR5_BASEPATH=t("[data-ckeditor-basepath]").attr("data-ckeditor-basepath"),CMS.CKEditor5={options:{language:"en",skin:"moono-lisa",toolbar_CMS:[["Undo","Redo"],["cmsplugins","cmswidget","-","ShowBlocks"],["Format","Styles"],["TextColor","BGColor","-","PasteText","PasteFromWord"],["Scayt"],["Maximize",""],"/",["Bold","Italic","Underline","Strike","-","Subscript","Superscript","-","RemoveFormat"],["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"],["HorizontalRule"],["NumberedList","BulletedList"],["Outdent","Indent","-","Blockquote","-","Link","Unlink","-","Table"],["Source"]],toolbar_HTMLField:[["Undo","Redo"],["ShowBlocks"],["Format","Styles"],["TextColor","BGColor","-","PasteText","PasteFromWord"],["Scayt"],["Maximize",""],"/",["Bold","Italic","Underline","Strike","-","Subscript","Superscript","-","RemoveFormat"],["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"],["HorizontalRule"],["Link","Unlink"],["NumberedList","BulletedList"],["Outdent","Indent","-","Blockqote","-","Link","Unlink","-","Table"],["Source"]],allowedContent:!0,toolbarCanCollapse:!1,removePlugins:"resize",extraPlugins:""},init:function(e,i,o){console.log("CMS.CKEditor5.init",e,i,o),t("#"+e).length>0&&(this.container=t("#"+e),this.container.data("ckeditor-initialized",!0),this.options.toolbar=o.toolbar,this.options=t.extend(!1,{settings:o},this.options,i),document.createElement("cms-plugin"),console.log("CKEDITOR classical to be created for",e),this.editor=CKEDITOR.ClassicEditor,this.editor.create(document.getElementById(e)).then(function(t){console.log("CKEDITOR instance ready")}).catch(function(t){console.error(t)}))},setup:function(){console.log("setup called");var e=this,i=window.parent||window;this._isAloneInModal()&&(e.editor.resize("100%",i.CMS.$(".cms-modal-frame").height()-70),this.editor.execCommand("maximize"),t(window).on("resize.ckeditor",function(){e._repositionDialog(CKEDITOR.dialog.getCurrent(),i)}).trigger("resize.ckeditor"),i.CMS.API.Helpers.addEventListener("modal-maximized modal-restored",function(){try{t(".cke_maximized").length||(e.editor.resize("100%",i.CMS.$(".cms-modal-frame").height()-70),setTimeout(function(){e._repositionDialog(CKEDITOR.dialog.getCurrent(),i)},0))}catch(t){}})),this.styles(),this._resizing()},styles:function(){t(".cke_button__maximize, .cke_button__source").parent().css("margin-right",0).parent().css("float","right")},_resizing:function(){t(document).on("pointerdown",".cms-ckeditor-resizer",function(e){e.preventDefault();var i=new CMS.$.Event("mousedown");t.extend(i,{screenX:e.originalEvent.screenX,screenY:e.originalEvent.screenY}),t(this).trigger(i)})},_isAloneInModal:function(){var t=this.container.closest("body");return t.is(".app-djangocms_text_ckeditor.model-text")||t.is(".djangocms_text_ckeditor-text")},_repositionDialog:function(t){if(t){var e=t.getSize(),i=t.getPosition(),o=CKEDITOR.document.getWindow(),n=o.getViewPaneSize(),r=n.width,s=n.height;i.x<0&&(t.move(0,i.y),i.x=0),i.y<0&&(t.move(i.x,0),i.y=0),i.y+e.height>s&&t.resize(e.width,s-i.y-80),i.x+e.width>r&&t.resize(r-i.x,e.height)}},_initAll:function(){var e=[];window._cmsCKEditors.forEach(function(t){t[0].match(/__prefix__/)?e.push(t):CMS.CKEditor5.init(t[0],t[1],t[2])}),t(".add-row a").on("click",function(){t(".CMS_CKEditor").each(function(i,o){var n=t(o);if(!n.data("ckeditor-initialized")){var r=n.attr("id");e.forEach(function(t){var e=t[0],i=new RegExp(e.replace("__prefix__","\\d+"));r.match(i)&&CMS.CKEditor5.init(r,t[1],t[2])})}})})}},setTimeout(function(){CMS.CKEditor5._initAll()},0)}(CMS.$);
});
})(CMS.$);
